<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Blue Monkey — 3D Maze (Twin-Stick v3)</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;font-family:system-ui,Arial}
  #hud{position:fixed;top:8px;left:0;right:0;text-align:center;color:#fff;font-weight:700;text-shadow:0 1px 2px #000;pointer-events:none;z-index:5}
  canvas{touch-action:none}
  /* twin joysticks */
  .stickZone{position:fixed;bottom:16px;width:40vmin;height:40vmin;max-width:46vw;max-height:46vw;
             border-radius:50%;background:rgba(255,255,255,.06);backdrop-filter:blur(2px);
             border:1px solid rgba(255,255,255,.12);touch-action:none;z-index:10}
  #left{left:16px}
  #right{right:16px}
  .knob{position:absolute;left:50%;top:50%;width:30%;height:30%;transform:translate(-50%,-50%);
        border-radius:50%;background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.5)}
  @media (min-width:900px){ .stickZone{display:none} } /* desktop: WASD + mouse drag */
</style>
</head>
<body>
<div id="hud">Left stick: Move • Right stick: Camera • Find the EXIT</div>
<canvas id="view"></canvas>

<div id="left" class="stickZone"><div class="knob"></div></div>
<div id="right" class="stickZone"><div class="knob"></div></div>

<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
<script>
(()=> {
  // ===== renderer / scene / camera =====
  const cvs = document.getElementById('view');
  const R = new THREE.WebGLRenderer({canvas:cvs, antialias:true});
  R.setClearColor(0x0e1216,1);
  const scene = new THREE.Scene();
  scene.fog = new THREE.Fog(0x0e1216, 40, 160);

  const cam = new THREE.PerspectiveCamera(58, 1, 0.1, 600);
  function resize(){
    const w=innerWidth,h=innerHeight;
    cam.aspect=w/h; cam.updateProjectionMatrix();
    R.setSize(w,h,false);
    R.setPixelRatio(Math.min(2, devicePixelRatio||1));
  }
  addEventListener('resize', resize); resize();

  // lights
  scene.add(new THREE.AmbientLight(0xffffff,.45));
  const sun = new THREE.DirectionalLight(0xffffff,.95); sun.position.set(1,1.6,0.8);
  scene.add(sun);

  // ===== materials =====
  const mWall  = new THREE.MeshToonMaterial({color:0x2b4458});
  const mFloor = new THREE.MeshToonMaterial({color:0x1a6a34});
  const mExit  = new THREE.MeshToonMaterial({color:0x57ff9a, emissive:0x1cff65, emissiveIntensity:.7});
  const mBlue  = new THREE.MeshToonMaterial({color:0x2d63ff});
  const mFace  = new THREE.MeshToonMaterial({color:0xffe1a8});
  const mBlack = new THREE.MeshToonMaterial({color:0x0d0d0d});

  // ===== maze generation =====
  const CELLS = 15, CELL=4, WALLH=3;
  const W = CELLS*2+1, H = CELLS*2+1;
  const grid = Array.from({length:H}, ()=> Array(W).fill(0));
  function carve(x,y){
    grid[y][x]=1;
    const dirs=[[2,0],[-2,0],[0,2],[0,-2]].sort(()=>Math.random()-
